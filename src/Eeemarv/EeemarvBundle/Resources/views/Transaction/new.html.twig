{% extends 'EeemarvBundle::base.html.twig' %}
{% form_theme form 'EeemarvBundle:Form:fields.html.twig' %}
{% block page_header_inner %}{{ 'transaction_new'|trans }}{% endblock %}


{% block inner_content -%}


    <form action="{{ path('eeemarv_eeemarv_transaction_create') }}" method="post" {{ form_enctype(form) }}>
		{{ form_errors(form) }}
		
		<input type="hidden" name="limit" value="{{ app.user.balanceLimit }}" id="limit">
		<input type="hidden" name="balance" value="{{ app.user.balance }}" id="balance">
		<input type="hidden" name="currency_rate" value="{{ currency_rate }}" id="currency_rate">
		{% set maximum = app.user.balance - app.user.balanceLimit %}
		
		
		{{ form_label(form.toCode) }}
		{{ form_errors(form.toCode) }}
		{{ form_widget(form.toCode, {'attr': {'autocomplete': 'off' }}) }}
		
    
		<div class="row-fluid">

		<div class="input-append span12">
		{{ form_label(form.amount) }}
		{{ form_errors(form.amount) }}		
			{{ form_widget(form.amount, {'attr': {'class': 'span2 text-right', 'placeholder': '0' }}) }}	
			<span class="add-on">{{ 'currency_plural'|trans({}, 'site') }}</span>
			<span class="add-on">{{ 'maximum'|trans({}, 'common') }}: <span id="maximum">{{ maximum // currency_rate }}</span></span> 
			{{ form_errors(form.amount) }}
		</div>	
		</div>	
			
		<div class="row-fluid">  
		
	
		  

			
			<div class="input-prepend input-append span6">
				<span class="add-on"><i class="fa fa-chevron-right"></i> <span id="rate">1:1</span></span>
				<input type="text" class="span2 text-right" placeholder="0" id="amount_destination">
	
				<span class="add-on">{{ 'currency_plural'|trans({}, 'site') }}</span>
			</div>			
			
			
		</div>
 		<div class="row-fluid">    

			{{ form_errors(form.amount) }}

		</div>
		
		
		{{ form_label(form.description) }}
		{{ form_errors(form.description) }}		
		{{ form_widget(form.description) }}

		{{ form_widget(form.create, {'attr':{'class':'btn btn-success'}}) }}
    
        {{ form_rest(form) }}

    </form>

        <ul class="record_actions">
			<li>
				<a href="{{ path('eeemarv_eeemarv_transaction_index') }}">
					{{ 'back_to_list'|trans }}
				</a>
			</li>
		</ul>


{% endblock %}

{% block javascripts_extra %}

<script>
$('document').ready(function(){
	$('#eeemarv_transaction_type_toCode').typeahead({
		name:'active_users_19',
		prefetch: 
			{ url:'{{ path('eeemarv_eeemarv_user_typeahead') }}',
			  filter: function(data){
					return data.map(function(user){
						return { 
							value : user.c + ' ' + user.n,
							tokens : [ user.c, user.n ],
							class : (user.e) ? 'warning' : ((user.s) ? 'info' : ((user.le) ? 'error' : ((user.a) ? 'success' : ''))),
							balance : user.b,
							limit : user.l
						};
					});
				},
			  ttl: 10000	
			},
		{% verbatim %}	
		template: '<p class="{{ class }}">{{ value }}</p>',
		{% endverbatim %}
		engine: Hogan
		});
	});
</script>

{% endblock %}
